<html>
	<script src="deps/require.js"></script>
	<script src="../dist/ink.amd.js"></script>
	<script>
		require(['jsink'], function(jsink) {
			fetch('stories/choice.ink.json')
			.then(response => {
				return response.text();
			})
			.then(data => {
				initStory(jsink.Story, data)
			});
		});
		
		function initStory(StoryClass, inkFile){
			var s = new StoryClass(inkFile);
			continueToNextChoice();

			function continueToNextChoice(){
				while (s.canContinue){
					console.log(s.Continue());
				}

				if (s.currentChoices.length > 0){
					for (var i = 0; i < s.currentChoices.length; ++i) {
						var choice = s.currentChoices[i];
						console.log((i + 1) + ". " + choice.text);
					}

					s.ChooseChoiceIndex(0);
					continueToNextChoice();
			//		rl.question('> ', (answer) => {
			//			s.ChooseChoiceIndex(parseInt(answer) - 1);
			//			continueToNextChoice();
			//		});
				}
				else{
					console.log('THE END');
					rl.close();
				}
			}
		}
	</script>
</html>